/**
 * Script to generate embedded SVGs from the images folder
 * Run with: node scripts/generate-embedded-svgs.cjs
 */

const fs = require('fs');
const path = require('path');

const imagesDir = path.join(__dirname, '../src/images');
const outputFile = path.join(__dirname, '../src/embeddedSvgs.ts');

// Get all SVG files
const svgFiles = fs.readdirSync(imagesDir)
  .filter(f => f.endsWith('.svg'))
  .sort((a, b) => {
    // Sort numerically by version number
    const numA = parseInt(a.match(/v(\d+)/)?.[1] || '0');
    const numB = parseInt(b.match(/v(\d+)/)?.[1] || '0');
    return numA - numB;
  });

// Generate TypeScript content
let content = `/**
 * Embedded SVG images for maker chip patterns.
 * Auto-generated by scripts/generate-embedded-svgs.cjs
 */

export const embeddedSvgs: Record<string, string> = {\n`;

for (const file of svgFiles) {
  const svgContent = fs.readFileSync(path.join(imagesDir, file), 'utf-8');
  // Convert filename to key: makerchip-v1.svg -> makerChipV1
  const key = file
    .replace('.svg', '')
    .replace(/makerchip-v(\d+)/, (_, num) => `makerChipV${num}`);
  
  // Escape backticks and convert to template literal
  const escapedContent = svgContent.replace(/`/g, '\\`').replace(/\$/g, '\\$');
  content += `  ${key}: \`${escapedContent}\`,\n`;
}

content += `};\n\n`;

// Generate data URL versions for button grid display
content += `/**
 * SVG data URLs for button grid display
 */
export const svgDataUrls: Record<string, string> = Object.fromEntries(
  Object.entries(embeddedSvgs).map(([key, svg]) => [
    key,
    \`data:image/svg+xml;base64,\${typeof btoa !== 'undefined' ? btoa(svg) : Buffer.from(svg).toString('base64')}\`
  ])
);
`;

fs.writeFileSync(outputFile, content);
console.log(`Generated ${outputFile} with ${svgFiles.length} SVGs`);
